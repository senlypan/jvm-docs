# æ ‡è®°-å‹ç¼©ç®—æ³•

> ä½œè€…: æ½˜æ·±ç»ƒ
>
> æ›´æ–°: 2022-03-09

## ä»€ä¹ˆæ˜¯æ ‡è®°-å‹ç¼©ç®—æ³•

æ ‡è®°-å¤åˆ¶ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œ æ•ˆç‡å°†ä¼šé™ä½ã€‚ æ›´å…³é”®çš„æ˜¯ï¼Œ å¦‚æœä¸æƒ³æµªè´¹`50%`çš„ç©ºé—´ï¼Œ å°±éœ€è¦æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œ ä»¥åº”å¯¹è¢«ä½¿ç”¨çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½100%å­˜æ´»çš„æç«¯æƒ…å†µï¼Œ æ‰€ä»¥åœ¨**è€å¹´ä»£ä¸€èˆ¬ä¸èƒ½ç›´æ¥é€‰ç”¨è¿™ç§ç®—æ³•**ã€‚

**é’ˆå¯¹è€å¹´ä»£å¯¹è±¡çš„å­˜äº¡ç‰¹å¾**ï¼Œ 1974å¹´Edward Luedersæå‡ºäº†å¦å¤–ä¸€ç§æœ‰é’ˆå¯¹æ€§çš„â€œæ ‡è®°-æ•´ç†â€ï¼ˆ`Mark-Compact`ï¼‰ ç®—æ³•ï¼Œ å…¶ä¸­çš„æ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œ ä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œ è€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘å†…å­˜ç©ºé—´ä¸€ç«¯ç§»åŠ¨ï¼Œ ç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜ ã€‚

GC æ ‡è®°-å‹ç¼©ç®—æ³•ç”±æ ‡è®°é˜¶æ®µå’Œå‹ç¼©é˜¶æ®µæ„æˆã€‚

GC æ ‡è®°-å‹ç¼©ç®—æ³•çš„æ ‡è®°é˜¶æ®µå’Œæ ‡è®°-æ¸…é™¤ç®—æ³•æ—¶æåˆ°çš„æ ‡è®°é˜¶æ®µå®Œå…¨ä¸€æ ·ã€‚è€Œå‹ç¼©é˜¶æ®µé€šè¿‡æ•°æ¬¡æœç´¢ç©ºé—²å †ï¼Œå¹¶é‡æ–°è£…å¡«æ´»åŠ¨å¯¹è±¡ã€‚å®ƒè·Ÿ GC å¤åˆ¶ç®—
æ³•ä¸åŒï¼Œä¸ç”¨ç‰ºç‰²åŠä¸ªå †ã€‚

GC æ ‡è®° - å‹ç¼©ç®—æ³•ï¼ˆ`Mark Compact GC`ï¼‰æ˜¯å°† GC æ ‡è®° - æ¸…é™¤ç®—æ³•ä¸ GC å¤åˆ¶ç®—æ³•ç›¸ç»“åˆçš„äº§ç‰©ã€‚

![03-mark-compact-001](../_media/image/03-mark-compact/03-mark-compact-001.png)

> æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸æ ‡è®°-å‹ç¼©ç®—æ³•çš„æœ¬è´¨å·®å¼‚åœ¨äºå‰è€…æ˜¯ä¸€ç§éç§»åŠ¨å¼çš„å›æ”¶ç®—æ³•ï¼Œ è€Œåè€…æ˜¯ç§»åŠ¨å¼çš„ã€‚ æ˜¯å¦ç§»åŠ¨å›æ”¶åçš„å­˜æ´»å¯¹è±¡æ˜¯ä¸€é¡¹ä¼˜ç¼ºç‚¹å¹¶å­˜çš„é£é™©å†³ç­–ã€‚

æ˜¯å¦ç§»åŠ¨å¯¹è±¡éƒ½å­˜åœ¨å¼Šç«¯ï¼Œ ç§»åŠ¨åˆ™å†…å­˜å›æ”¶æ—¶ä¼šæ›´å¤æ‚ï¼Œ ä¸ç§»åŠ¨åˆ™å†…å­˜åˆ†é…æ—¶ä¼šæ›´å¤æ‚ã€‚ ä»åƒåœ¾æ”¶é›†çš„åœé¡¿æ—¶é—´æ¥çœ‹ï¼Œ ä¸ç§»åŠ¨å¯¹è±¡åœé¡¿æ—¶é—´ä¼šæ›´çŸ­ï¼Œ ç”šè‡³å¯ä»¥ä¸éœ€è¦åœé¡¿ï¼Œ ä½†æ˜¯ä»æ•´ä¸ªç¨‹åºçš„ **ååé‡** æ¥çœ‹ï¼Œ ç§»åŠ¨å¯¹è±¡ä¼šæ›´åˆ’ç®—ã€‚

## ä¼˜ç‚¹

### å¯æœ‰æ•ˆåˆ©ç”¨å †

GC æ ‡è®° - å‹ç¼©ç®—æ³•ä¸­ä¼šæ‰§è¡Œå‹ç¼©ï¼Œå’Œå…¶ä»–ç®—æ³•ç›¸æ¯”è€Œè¨€ï¼Œå †åˆ©ç”¨æ•ˆç‡é«˜ã€‚

## ç¼ºç‚¹

### å‹ç¼©èŠ±è´¹è®¡ç®—æˆæœ¬

å‹ç¼©æœ‰ç€å·¨å¤§çš„å¥½å¤„ã€‚ä¸è¿‡ä¸ºäº†äº«å—è¿™äº›å¥½å¤„ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åšå‡ºå·¨å¤§çš„ç‰ºç‰²ã€‚

æ‰§è¡Œè¯¥ç®—æ³•æ‰€èŠ±è´¹çš„æ—¶é—´æ˜¯å’Œå †å¤§å°æˆæ­£æ¯”çš„ã€‚GC æ ‡è®° - å‹ç¼©ç®—æ³•çš„ååé‡è¦åŠ£äºå…¶ä»–ç®—æ³•ã€‚

åœ¨ GC æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸­ï¼Œæ¸…é™¤é˜¶æ®µä¹Ÿè¦æœç´¢æ•´ä¸ªå †ï¼Œä¸è¿‡æœç´¢ 1 æ¬¡å°±å¤Ÿäº†ã€‚ä½† GC æ ‡è®°-å‹ç¼©ç®—æ³•è¦æœç´¢ 3 æ¬¡ï¼Œè¿™æ ·å°±è¦èŠ±è´¹çº¦ 3 å€çš„æ—¶é—´ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å·¨å¤§çš„ç¼ºé™·ï¼Œç‰¹åˆ«æ˜¯å †è¶Šå¤§ï¼Œæ‰€æ¶ˆè€—çš„æˆæœ¬ä¹Ÿå°±è¶Šå¤§ã€‚


## ğŸ‘‰ ä¸ºä»€ä¹ˆæ ‡è®°å¤åˆ¶ç®—æ³•æ¯”æ ‡è®°å‹ç¼©ç®—æ³•å¿«ï¼Ÿ

Qï¼šæ ‡è®°å¤åˆ¶ç®—æ³•å’Œæ ‡è®°æ•´ç†ç®—æ³•ï¼ŒåŒæ ·éƒ½æ˜¯ç§»åŠ¨åˆ°å †å†…å­˜çš„ä¸€ç«¯æ’æ”¾ã€‚ä¸ºä»€ä¹ˆæ ‡è®°å¤åˆ¶ç®—æ³•å¤šåŠ äº†ä¸€å€å†…å­˜å°±å¿«äº†ï¼Ÿ

A: æ ‡è®°å‹ç¼©ç®—æ³•å¿…é¡»ç­‰ `gcroot` éå†å®Œï¼Œå› ä¸ºå †é‡Œé¢çš„å¯¹è±¡æ˜¯`ç½‘çŠ¶å…³è”`çš„ï¼Œä¸èƒ½ä¸€è¾¹éå†ä¸€è¾¹æ•´ç†ï¼Œæœ‰å¯èƒ½ä½ è¦æ•´ç†åˆ°çš„ä½ç½®è¿˜æœ‰å­˜æ´»çš„å¯¹è±¡æ²¡æ‰«æå‘¢ã€‚è€Œæ ‡è®°å¤åˆ¶ç®—æ³•å¼€è¾Ÿçš„å†…å­˜å®Œå…¨æ˜¯ä¸€ä¸ªå®Œå…¨éš”ç¦»çš„æ–°åŒºåŸŸï¼Œæ‰€ä»¥ä¸ç”¨æ€•è¦†ç›–å…¶ä»–å¯¹è±¡ã€‚æ‰€ä»¥å¤åˆ¶ç®—æ³•æ–°å¼€è¾Ÿçš„å†…å­˜å…¶å®æ˜¯æ¢æ¥äº†éš”ç¦»ã€‚éš”ç¦»å‡å°‘äº†æ•°æ®å†²çªï¼Œä»è€Œæå‡äº†å¤„ç†æ€§èƒ½ã€‚ï¼ˆ**ç†è§£CopyOnWriteæ€æƒ³**ï¼‰


ï¼ˆæœ¬ç¯‡å®Œï¼‰

?> â¤ï¸ æ‚¨ä¹Ÿå¯ä»¥å‚ä¸æ¢³ç†ï¼Œå¿«æ¥æäº¤ [issue](https://github.com/senlypan/jvm-docs/issues) æˆ–æŠ•ç¨¿å‚ä¸å§~